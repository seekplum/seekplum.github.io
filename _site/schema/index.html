<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" lang="zh-CN">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <meta name="author" content="HJD"/>
    <title>数据校验</title>
    <link rel="shortcut icon" href="/favicon.ico"/>
    <link href="/feed/" rel="alternate" title="HJD" type="application/atom+xml"/>
    <link rel="stylesheet" href="/static/css/style.css"/>
    <!--<link rel="stylesheet" href="/static/css/home.css"/>-->
    <link rel="stylesheet" href="/static/css/pygments.css"/>
    <script type="text/javascript" src="/static/js/highlight.pack.js"></script>
    <script> hljs.initHighlightingOnLoad(); </script>
    <script type="text/javascript" src="/static/js/jquery-1.7.1.min.js"></script>
    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                        (i[r].q = i[r].q || []).push(arguments)
                    }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                    m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-72892124-1', 'auto');
        ga('send', 'pageview');

    </script>
</head>
<body>
<div id="container">
    <div id="main" role="main">
        <header>
            <h1>数据校验</h1>
        </header>
        <nav>
            <span><a title="首页" class="tag-index" href="/">首页</a></span>
            <span><a title="分类" class="tag-categories" href="/categories/">分类</a></span>
            <span><a title="标签" class="tag-tags" href="/tags/">标签</a></span>
            <span><a title="留言" class="tag-guestbook" href="/guestbook/">留言</a></span>
            <span><a title="关于" class="tag-about" href="/about/">关于</a></span>
        </nav>
        <article class="content">
            <section class="meta">
  <span class="time">
    <time datetime='2016-12-11'>2016-12-11</time>
  </span>
    
    |
  <span class="categories">
    分类
    
    <a href="/categories/#python" title="python">python</a>&nbsp;
    
  </span>
    
    
    |
  <span class="tags">
    标签
    
    <a href="/tags/#util" title="util">util</a>&nbsp;
    
  </span>
    
</section>
<section class="post">
    <h3 id="githubhttpsgithubcomkeleshevschema">安装 <a href="https://github.com/keleshev/schema">github地址</a></h3>

<blockquote>
  <p>pip install schma</p>
</blockquote>

<h3 id="section">基本用法</h3>

<p><code class="highlighter-rouge">
import schema
schema.Schema(xxx).validate(data)
其中参数xxx可以是：
基本数据类型:：比如int/float/list/tuple/set/str等。
函数： list, tuple, set, frozenset, dict实例
某个重写了validate方法的类： 比如Use
</code></p>

<h3 id="schemaerror-">验证失败报 SchemaError 异常，需要自己处理</h3>

<p><code class="highlighter-rouge">
try:
    # 判断是否为 int 类型数据
    result = schema.Schema(int).validate(12.3)
except schema.SchemaError as e:
    # 验证失败则是抛出 SchemaError 异常
    print "异常：", str(e)
</code></p>

<h3 id="section-1">先进行转换在验证</h3>

<p><code class="highlighter-rouge">
schema.Schema(Use(int)).validate('123')
</code></p>

<h3 id="section-2">参数是容器类型</h3>

<p><code class="highlighter-rouge">
schema.Schema([1, 0]).validate([1, 1, 0, 0]) \# 数据只能是1,0
</code></p>

<h3 id="key-value">验证字典的key, value</h3>

<p><code class="highlighter-rouge">
schema.Schema({'name': str, 'age': lambda n: 10 &lt; n &lt; 99}).validate({'name': 'abc', 'age': 14})
</code></p>

<h3 id="object">部分键值验证, 不用验证的部分写object即可</h3>

<p><code class="highlighter-rouge">
schema.Schema({'name': str, str: object}).validate({'name': '0', 'aa': 'da'})
</code></p>

<h3 id="optional--ddint">Optional 可选： dd可以不存在，但存在必须是int类型</h3>

<p><code class="highlighter-rouge">
schema.Schema({'name': str, Optional('dd'): int}).validate({'name': 'Sam', 'dd': 1})
</code></p>

<h3 id="and-">And 与</h3>

<p><code class="highlighter-rouge">
schema.Schema({'age': And(int, lambda n: 0 &lt; n &lt; 100)}).validate({'age': 7})
</code></p>

<h3 id="or-">Or 或</h3>
<p><code class="highlighter-rouge">
schema.Schema(And(Or(int, float), lambda x: x &gt; 0)).validate(3.6)
</code></p>

</section>
<section align="right">
    <br/>
  <span>
    <a  href="/tempfile/" class="pageNav"  >上一篇</a>
    &nbsp;&nbsp;&nbsp;
    <a  
       class="pageNavInvalid" >下一篇</a>
  </span>
</section>

	
	<div class="ds-thread" data-thread-key="schema" data-url="hmbd.github.io/schema/" data-title="数据校验" />
		
	<script type="text/javascript">
	var duoshuoQuery = {short_name: "hmbd"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = '/static/js/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0]
		|| document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>

<script type="text/javascript">
    /*
     功能：生成博客目录的JS工具
     */
    var BlogDirectory = {
        /*
         获取元素位置，距浏览器左边界的距离（left）和距浏览器上边界的距离（top）
         */
        getElementPosition: function (ele) {
            var topPosition = 0;
            var leftPosition = 0;
            while (ele) {
                topPosition += ele.offsetTop;
                leftPosition += ele.offsetLeft;
                ele = ele.offsetParent;
            }
            return {top: topPosition, left: leftPosition};
        },

        /*
         获取滚动条当前位置
         */
        getScrollBarPosition: function () {
            var scrollBarPosition = document.body.scrollTop || document.documentElement.scrollTop;
            return scrollBarPosition;
        },

        /*
         移动滚动条，finalPos 为目的位置，internal 为移动速度
         */
        moveScrollBar: function (finalpos, interval) {

            //若不支持此方法，则退出
            if (!window.scrollTo) {
                return false;
            }

            //窗体滚动时，禁用鼠标滚轮
            window.onmousewheel = function () {
                return false;
            };

            //清除计时
            if (document.body.movement) {
                clearTimeout(document.body.movement);
            }

            var currentpos = BlogDirectory.getScrollBarPosition();//获取滚动条当前位置

            var dist = 0;
            if (currentpos == finalpos) {//到达预定位置，则解禁鼠标滚轮，并退出
                window.onmousewheel = function () {
                    return true;
                };
                return true;
            }
            if (currentpos < finalpos) {//未到达，则计算下一步所要移动的距离
                dist = Math.ceil((finalpos - currentpos) / 10);
                currentpos += dist;
            }
            if (currentpos > finalpos) {
                dist = Math.ceil((currentpos - finalpos) / 10);
                currentpos -= dist;
            }

            var scrTop = BlogDirectory.getScrollBarPosition();//获取滚动条当前位置
            window.scrollTo(0, currentpos);//移动窗口
            if (BlogDirectory.getScrollBarPosition() == scrTop)//若已到底部，则解禁鼠标滚轮，并退出
            {
                window.onmousewheel = function () {
                    return true;
                };
                return true;
            }

            //进行下一步移动
            var repeat = "BlogDirectory.moveScrollBar(" + finalpos + "," + interval + ")";
            document.body.movement = setTimeout(repeat, interval);
        },

        htmlDecode: function (text) {
            var temp = document.createElement("div");
            temp.innerHTML = text;
            var output = temp.innerText || temp.textContent;
            temp = null;
            return output;
        },

        /*
         创建博客目录，
         id表示包含博文正文的 div 容器的 id，
         mt 和 st 分别表示主标题和次级标题的标签名称（如 H2、H3，大写或小写都可以！），
         interval 表示移动的速度
         */
        createBlogDirectory: function (id, mt, st, interval) {
            //获取博文正文div容器
            var elem = document.getElementById(id);
            if (!elem) return false;
            //获取div中所有元素结点
            var nodes = elem.getElementsByTagName("*");
            //创建博客目录的div容器
            var divSideBar = document.createElement('DIV');
            divSideBar.className = 'sideBar';
            divSideBar.setAttribute('id', 'sideBar');
            var divSideBarTab = document.createElement('DIV');
            divSideBarTab.setAttribute('id', 'sideBarTab');
            divSideBar.appendChild(divSideBarTab);
            var h2 = document.createElement('H2');
            divSideBarTab.appendChild(h2);
            var txt = document.createTextNode('目录导航');
            h2.appendChild(txt);
            var divSideBarContents = document.createElement('DIV');
            //目录导航初始 显示
            divSideBarContents.style.display = 'block';
            divSideBarContents.setAttribute('id', 'sideBarContents');
            divSideBar.appendChild(divSideBarContents);
            //创建自定义列表
            var dlist = document.createElement("dl");
            divSideBarContents.appendChild(dlist);
            var num = 0;//统计找到的mt和st
            mt = mt.toUpperCase();//转化成大写
            st = st.toUpperCase();//转化成大写
            //遍历所有元素结点
            for (var i = 0; i < nodes.length; i++) {
                if (nodes[i].nodeName == mt || nodes[i].nodeName == st) {
                    //获取标题文本
                    var nodetext = nodes[i].innerHTML.replace(/<\/?[^>]+>/g, "");//innerHTML里面的内容可能有HTML标签，所以用正则表达式去除HTML的标签
                    nodetext = nodetext.replace(/&nbsp;/ig, "");//替换掉所有的&nbsp;
                    var len = 13; // 目录显示字数
                    if (nodetext.length > len) {
                        nodetext = nodetext.slice(0, len);
                        nodetext = nodetext + '...';
                    }
                    nodetext = BlogDirectory.htmlDecode(nodetext);
                    //插入锚
                    nodes[i].setAttribute("id", "blogTitle" + num);
                    var item;
                    switch (nodes[i].nodeName) {
                        case mt:    //若为主标题
                            item = document.createElement("dt");
                            break;
                        case st:    //若为子标题
                            item = document.createElement("dd");
                            break;
                    }

                    //创建锚链接
                    var itemtext = document.createTextNode(nodetext);
                    item.appendChild(itemtext);
                    item.setAttribute("name", num);
                    item.onclick = function () {        //添加鼠标点击触发函数
                        var pos = BlogDirectory.getElementPosition(document.getElementById("blogTitle" + this.getAttribute("name")));
                        if (!BlogDirectory.moveScrollBar(pos.top, interval)) return false;
                    };

                    //将自定义表项加入自定义列表中
                    dlist.appendChild(item);
                    num++;
                }
            }

            if (num == 0) return false;
            /*鼠标进入时的事件处理*/
            divSideBarTab.onmouseenter = function () {
                divSideBarTab.style.background = '#00bcff';
            };
            /*鼠标离开时的事件处理*/
            divSideBar.onmouseleave = function () {
                divSideBarTab.style.background = '#ffffff';
            };

            document.body.appendChild(divSideBar);


            // 目录导航显示隐藏
            var btn = document.getElementById('sideBarTab');

            btn.addEventListener('click', function () {
                if (divSideBarContents.style.display == "block") {
                    divSideBarContents.style.display = 'none';
                }
                else {
                    divSideBarContents.style.display = 'block';
                }
            }, false);
        }

    };

    window.onload = function () {
        /*页面加载完成之后生成博客目录*/
        BlogDirectory.createBlogDirectory("main", "h2", "h3", 20);
    }
</script>

        </article>
    </div>
    <div class='toTop' style="opacity: 1;" title="返回顶部">
        <div class="arrow"></div>
        <div class="stick"></div>
    </div>

    <footer>
        <p>
            <small>
                <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/cn/" target="_blank"
                   title="许可协议">©</a>2016 <a href="/about/">HJD</a>
            </small>
        </p>
    </footer>

</div>
<script>
    /* 返回顶部函数 */
    $(function () {
        var $backToTopEle = $('.toTop'), $backToTopFun = function () {
            var st = $(document).scrollTop(), winh = $(window).height();
            (st > 200) ? $backToTopEle.fadeIn('slow') : $backToTopEle.fadeOut('slow');
            //IE6下的定位
            if (!window.XMLHttpRequest) {
                $backToTopEle.css("top", st + winh - 166);
            }
        };
        $('.toTop').click(function () {
            $("html, body").animate({scrollTop: 0}, 700); // 700毫秒
        });
        $backToTopEle.hide();
        $backToTopFun();
        $(window).bind("scroll", $backToTopFun);
        $('#catalogWord').click(function () {
            $("#catalog").slideToggle(600);
        })
    });

    /* 选中标签填充背景色 */
    $(function () {
        var last_url = window.location.pathname;
        var all_class = ['index', 'categories', 'tags', 'guestbook', 'about'];
        var all_url = ['/', '/categories/', '/tags/', '/guestbook/', '/about/'];
        $.each(all_url, function (index, value) {
            if (last_url == value) {
                var tag_class = ".tag-" + all_class[index];
                $(tag_class).css("background-color", "#ddd"); // #f5f5f5
            }
        });

    });
</script>
</body>
</html>
