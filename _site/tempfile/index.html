<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" lang="zh-CN">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <meta name="author" content="HJD"/>
    <title>tempfile创建临时文件</title>
    <link rel="shortcut icon" href="/favicon.ico"/>
    <link href="/feed/" rel="alternate" title="HJD" type="application/atom+xml"/>
    <link rel="stylesheet" href="/static/css/style.css"/>
    <!--<link rel="stylesheet" href="/static/css/home.css"/>-->
    <link rel="stylesheet" href="/static/css/pygments.css"/>
    <script type="text/javascript" src="/static/js/highlight.pack.js"></script>
    <script> hljs.initHighlightingOnLoad(); </script>
    <script type="text/javascript" src="/static/js/jquery-1.7.1.min.js"></script>
    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                        (i[r].q = i[r].q || []).push(arguments)
                    }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                    m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-72892124-1', 'auto');
        ga('send', 'pageview');

    </script>
</head>
<body>
<div id="container">
    <div id="main" role="main">
        <header>
            <h1>tempfile创建临时文件</h1>
        </header>
        <nav>
            <span><a title="首页" class="tag-index" href="/">首页</a></span>
            <span><a title="分类" class="tag-categories" href="/categories/">分类</a></span>
            <span><a title="标签" class="tag-tags" href="/tags/">标签</a></span>
            <span><a title="留言" class="tag-guestbook" href="/guestbook/">留言</a></span>
            <span><a title="关于" class="tag-about" href="/about/">关于</a></span>
        </nav>
        <article class="content">
            <section class="meta">
  <span class="time">
    <time datetime='2016-12-10'>2016-12-10</time>
  </span>
    
    |
  <span class="categories">
    分类
    
    <a href="/categories/#python" title="python">python</a>&nbsp;
    
  </span>
    
    
    |
  <span class="tags">
    标签
    
    <a href="/tags/#util" title="util">util</a>&nbsp;
    
  </span>
    
</section>
<section class="post">
    <h3 id="section">普通方法 创建临时文件存储数据</h3>

<p>```
import os</p>

<p>def create_temp_file():
    print “正常方法 开始创建临时文件…”
    filename = ‘%s.txt’ % os.getpid()</p>

<div class="highlighter-rouge"><pre class="highlight"><code>temp = open(filename, 'wb+')
try:
    print "temp name: ", temp.name
    temp.write("123456789abc")
finally:
    temp.close()
    os.remove(filename) ```
</code></pre>
</div>

<h3 id="tempfile-">tempfile 创建临时文件，创建的临时文件没有名字</h3>

<p><code class="highlighter-rouge">
def temp_file():
    print "temp file 创建临时文件..."
    # TemporaryFile创建的临时文件没有文件名
    temp = tempfile.TemporaryFile()
    try:
        print "temp name:", temp.name
        temp.write('123456789abc')
        # 不用seek(N)无法读取数据: 从N开始往后读取
        temp.seek(0)
        print temp.read()
    finally:
        temp.close()
</code>
&gt; 创建文件时指定模式</p>

<p>```
def temp_file_mode():
    print “temp file 以text模式运行”
    temp = tempfile.TemporaryFile(mode=’w+t’)
    try:
        temp.writelines([‘first\n’, ‘second\n’])
        temp.seek(0)</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    for line in temp:
        print "line:", line.rstrip()
finally:
    temp.close() ```
</code></pre>
</div>

<h3 id="tempfile">tempfile创建有名字的临时文件</h3>

<p><code class="highlighter-rouge">
def temp_file_name():
    print "创建有名字的临时文件..."
    # 创建后还是会自动删除
    temp = tempfile.NamedTemporaryFile()
    # 自己定义文件名格式 dir + prefix + random + suffix
    temp_name = tempfile.NamedTemporaryFile(suffix='_suffix', prefix='prefix_', dir='/tmp')
    try:
        print "temp name:", temp.name
        print "temp_name:", temp_name.name
    finally:
        temp.close()
</code></p>

<blockquote>
  <p>创建需要自己手动删除的临时文件</p>
</blockquote>

<p><code class="highlighter-rouge">
def temp_file_mkstemp():
    print "创建需要手动删除的临时文件..."
    # 创建临时文件, 需要手动删除。 返回两个参数： 临时文件安全级别， 临时文件路径
    security_level, file_name = tempfile.mkstemp(suffix='_suffix', prefix='prefix_', dir='/tmp', text=False)
    print "安全级别：", security_level
    print "文件名：", file_name
</code></p>

<h3 id="tempfile-1">tempfile创建临时目录</h3>

<p><code class="highlighter-rouge">
def temp_file_dir():
    print "创建临时目录..."
    # 目录需要自己手动删除
    directory_name = tempfile.mkdtemp(suffix='_suffix', prefix='prefix_', dir='/tmp')
    print directory_name
</code></p>

<blockquote>
  <p>只返回临时文件路径，并不真正创建</p>
</blockquote>

<p><code class="highlighter-rouge">
def temp_file_mktemp():
    print "返回临时文件的路径..."
    # 返回一个临时文件的路径，但并不创建该临时文件
    file_name = tempfile.mktemp(suffix='_suffix', prefix='prefix_')
    print file_name
</code></p>

</section>
<section align="right">
    <br/>
  <span>
    <a  href="/linux-knowledge/" class="pageNav"  >上一篇</a>
    &nbsp;&nbsp;&nbsp;
    <a  href="/schema/" class="pageNav"  >下一篇</a>
  </span>
</section>

	
	<div class="ds-thread" data-thread-key="tempfile" data-url="hmbd.github.io/tempfile/" data-title="tempfile创建临时文件" />
		
	<script type="text/javascript">
	var duoshuoQuery = {short_name: "hmbd"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = '/static/js/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0]
		|| document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>

<script type="text/javascript">
    /*
     功能：生成博客目录的JS工具
     */
    var BlogDirectory = {
        /*
         获取元素位置，距浏览器左边界的距离（left）和距浏览器上边界的距离（top）
         */
        getElementPosition: function (ele) {
            var topPosition = 0;
            var leftPosition = 0;
            while (ele) {
                topPosition += ele.offsetTop;
                leftPosition += ele.offsetLeft;
                ele = ele.offsetParent;
            }
            return {top: topPosition, left: leftPosition};
        },

        /*
         获取滚动条当前位置
         */
        getScrollBarPosition: function () {
            var scrollBarPosition = document.body.scrollTop || document.documentElement.scrollTop;
            return scrollBarPosition;
        },

        /*
         移动滚动条，finalPos 为目的位置，internal 为移动速度
         */
        moveScrollBar: function (finalpos, interval) {

            //若不支持此方法，则退出
            if (!window.scrollTo) {
                return false;
            }

            //窗体滚动时，禁用鼠标滚轮
            window.onmousewheel = function () {
                return false;
            };

            //清除计时
            if (document.body.movement) {
                clearTimeout(document.body.movement);
            }

            var currentpos = BlogDirectory.getScrollBarPosition();//获取滚动条当前位置

            var dist = 0;
            if (currentpos == finalpos) {//到达预定位置，则解禁鼠标滚轮，并退出
                window.onmousewheel = function () {
                    return true;
                };
                return true;
            }
            if (currentpos < finalpos) {//未到达，则计算下一步所要移动的距离
                dist = Math.ceil((finalpos - currentpos) / 10);
                currentpos += dist;
            }
            if (currentpos > finalpos) {
                dist = Math.ceil((currentpos - finalpos) / 10);
                currentpos -= dist;
            }

            var scrTop = BlogDirectory.getScrollBarPosition();//获取滚动条当前位置
            window.scrollTo(0, currentpos);//移动窗口
            if (BlogDirectory.getScrollBarPosition() == scrTop)//若已到底部，则解禁鼠标滚轮，并退出
            {
                window.onmousewheel = function () {
                    return true;
                };
                return true;
            }

            //进行下一步移动
            var repeat = "BlogDirectory.moveScrollBar(" + finalpos + "," + interval + ")";
            document.body.movement = setTimeout(repeat, interval);
        },

        htmlDecode: function (text) {
            var temp = document.createElement("div");
            temp.innerHTML = text;
            var output = temp.innerText || temp.textContent;
            temp = null;
            return output;
        },

        /*
         创建博客目录，
         id表示包含博文正文的 div 容器的 id，
         mt 和 st 分别表示主标题和次级标题的标签名称（如 H2、H3，大写或小写都可以！），
         interval 表示移动的速度
         */
        createBlogDirectory: function (id, mt, st, interval) {
            //获取博文正文div容器
            var elem = document.getElementById(id);
            if (!elem) return false;
            //获取div中所有元素结点
            var nodes = elem.getElementsByTagName("*");
            //创建博客目录的div容器
            var divSideBar = document.createElement('DIV');
            divSideBar.className = 'sideBar';
            divSideBar.setAttribute('id', 'sideBar');
            var divSideBarTab = document.createElement('DIV');
            divSideBarTab.setAttribute('id', 'sideBarTab');
            divSideBar.appendChild(divSideBarTab);
            var h2 = document.createElement('H2');
            divSideBarTab.appendChild(h2);
            var txt = document.createTextNode('目录导航');
            h2.appendChild(txt);
            var divSideBarContents = document.createElement('DIV');
            //目录导航初始 显示
            divSideBarContents.style.display = 'block';
            divSideBarContents.setAttribute('id', 'sideBarContents');
            divSideBar.appendChild(divSideBarContents);
            //创建自定义列表
            var dlist = document.createElement("dl");
            divSideBarContents.appendChild(dlist);
            var num = 0;//统计找到的mt和st
            mt = mt.toUpperCase();//转化成大写
            st = st.toUpperCase();//转化成大写
            //遍历所有元素结点
            for (var i = 0; i < nodes.length; i++) {
                if (nodes[i].nodeName == mt || nodes[i].nodeName == st) {
                    //获取标题文本
                    var nodetext = nodes[i].innerHTML.replace(/<\/?[^>]+>/g, "");//innerHTML里面的内容可能有HTML标签，所以用正则表达式去除HTML的标签
                    nodetext = nodetext.replace(/&nbsp;/ig, "");//替换掉所有的&nbsp;
                    nodetext = BlogDirectory.htmlDecode(nodetext);
                    //插入锚
                    nodes[i].setAttribute("id", "blogTitle" + num);
                    var item;
                    switch (nodes[i].nodeName) {
                        case mt:    //若为主标题
                            item = document.createElement("dt");
                            break;
                        case st:    //若为子标题
                            item = document.createElement("dd");
                            break;
                    }

                    //创建锚链接
                    var itemtext = document.createTextNode(nodetext);
                    item.appendChild(itemtext);
                    item.setAttribute("name", num);
                    item.onclick = function () {        //添加鼠标点击触发函数
                        var pos = BlogDirectory.getElementPosition(document.getElementById("blogTitle" + this.getAttribute("name")));
                        if (!BlogDirectory.moveScrollBar(pos.top, interval)) return false;
                    };

                    //将自定义表项加入自定义列表中
                    dlist.appendChild(item);
                    num++;
                }
            }

            if (num == 0) return false;
            /*鼠标进入时的事件处理*/
            divSideBarTab.onmouseenter = function () {
                divSideBarTab.style.background = '#00bcff';
            };
            /*鼠标离开时的事件处理*/
            divSideBar.onmouseleave = function () {
                divSideBarTab.style.background = '#ffffff';
            };

            document.body.appendChild(divSideBar);


            // 目录导航显示隐藏
            var btn = document.getElementById('sideBarTab');

            btn.addEventListener('click', function () {
                if (divSideBarContents.style.display == "block") {
                    divSideBarContents.style.display = 'none';
                }
                else {
                    divSideBarContents.style.display = 'block';
                }
            }, false);
        }

    };

    window.onload = function () {
        /*页面加载完成之后生成博客目录*/
        BlogDirectory.createBlogDirectory("main", "h1", "h3", 20);
    }
</script>

        </article>
    </div>
    <div class='toTop' style="opacity: 1;" title="返回顶部">
        <div class="arrow"></div>
        <div class="stick"></div>
    </div>

    <footer>
        <p>
            <small>
                <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/cn/" target="_blank"
                   title="许可协议">©</a>2016 <a href="/about/">HJD</a>
            </small>
        </p>
    </footer>

</div>
<script>
    /* 返回顶部函数 */
    $(function () {
        var $backToTopEle = $('.toTop'), $backToTopFun = function () {
            var st = $(document).scrollTop(), winh = $(window).height();
            (st > 200) ? $backToTopEle.fadeIn('slow') : $backToTopEle.fadeOut('slow');
            //IE6下的定位
            if (!window.XMLHttpRequest) {
                $backToTopEle.css("top", st + winh - 166);
            }
        };
        $('.toTop').click(function () {
            $("html, body").animate({scrollTop: 0}, 700); // 700毫秒
        });
        $backToTopEle.hide();
        $backToTopFun();
        $(window).bind("scroll", $backToTopFun);
        $('#catalogWord').click(function () {
            $("#catalog").slideToggle(600);
        })
    });

    /* 选中标签填充背景色 */
    $(function () {
        var last_url = window.location.pathname;
        var all_class = ['index', 'categories', 'tags', 'guestbook', 'about'];
        var all_url = ['/', '/categories/', '/tags/', '/guestbook/', '/about/'];
        $.each(all_url, function (index, value) {
            if (last_url == value) {
                var tag_class = ".tag-" + all_class[index];
                $(tag_class).css("background-color", "#ddd"); // #f5f5f5
            }
        });

    });
</script>
</body>
</html>
